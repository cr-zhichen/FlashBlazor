@inject NavigationManager NavigationManager
@inject ILocalStorageService LocalStorage
@inject IJwtService JwtService
@inject IUserSessionService UserSessionService

@code {

    [Parameter]
    public UserRole? Role { get; set; }

    override protected async Task OnAfterRenderAsync(bool firstRender)
    {
        if (String.IsNullOrEmpty(UserSessionService.Token))
        {
            
        }
        
        var token = await LocalStorage.GetItemAsync<string>("token");
        if (string.IsNullOrEmpty(token))
        {
            NavigationManager.NavigateTo("/login");
            return;
        }

        var isValid = await JwtService.ValidateTokenAsync(token, Role.ToString() ?? "");

        if (!isValid)
        {
            NavigationManager.NavigateTo("/login");
            return;
        }

        await base.OnAfterRenderAsync(firstRender);
    }
}